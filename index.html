<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Emoji Alchemy</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #222;
    color: #eee;
    margin: 0;
    padding: 0;
    user-select: none;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  #homeScreen, #gameScreen {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  #homeScreen {
    background: linear-gradient(45deg, #4a90e2, #50e3c2);
  }
  #homeScreen h1 {
    font-size: 3rem;
    margin-bottom: 20px;
    text-shadow: 0 0 10px #000;
  }
  #homeScreen button {
    font-size: 1.5rem;
    padding: 15px 40px;
    cursor: pointer;
    border: none;
    border-radius: 10px;
    background: #fff;
    color: #333;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    transition: background 0.3s;
  }
  #homeScreen button:hover {
    background: #ddd;
  }
  #gameScreen {
    background: #111;
    padding: 10px;
    position: relative;
  }
  #inventory {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: auto;
    padding: 10px;
    background: #222;
    border-top: 2px solid #555;
    min-height: 120px;
  }
  .emoji {
    font-size: 48px;
    cursor: grab;
    user-select: none;
    background: #333;
    padding: 10px;
    border-radius: 12px;
    box-shadow: 0 0 8px #000 inset;
    transition: transform 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 64px;
    height: 64px;
    text-align: center;
  }
  .emoji.dragging {
    opacity: 0.7;
    cursor: grabbing;
    transform: scale(1.2);
    z-index: 1000;
    position: relative;
  }
  .emoji.selected {
    outline: 3px solid #4af;
    transform: scale(1.15);
  }
  #unlockedCounter {
    font-size: 1.2rem;
    margin: 10px 0;
    text-align: center;
  }
  #message {
    text-align: center;
    margin: 10px;
    min-height: 24px;
    font-weight: bold;
    color: #4af;
  }
  #backButton {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #444;
    color: #eee;
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    user-select: none;
  }
  #backButton:hover {
    background: #666;
  }
</style>
</head>
<body>

<div id="homeScreen">
  <h1>Emoji Alchemy</h1>
  <button id="playBtn">Play</button>
</div>

<div id="gameScreen" style="display:none;">
  <button id="backButton">Home</button>
  <div id="unlockedCounter">Unlocked 0/30</div>
  <div id="message"></div>
  <div id="inventory" aria-label="Emoji Inventory"></div>
</div>

<script>
(() => {
  // Recipes: combine two emojis (sorted alphabetically), result emoji
  const recipes = {
    "ðŸ’§+ðŸ’§": "ðŸ’¦",         // water drop + drop = splash
    "ðŸ’¦+ðŸ’¦": "ðŸŒ§ï¸",       // splash + splash = rain cloud
    "ðŸŒ§ï¸+ðŸŒ§ï¸": "ðŸŒŠ",       // rain cloud + rain cloud = ocean wave
    "ðŸ”¥+ðŸ”¥": "ðŸ’¥",         // fire + fire = explosion
    "ðŸ”¥+ðŸ’§": "ðŸŒˆ",         // fire + water = rainbow
    "ðŸŒ±+ðŸŒ±": "ðŸŒ¿",         // seedling + seedling = herb
    "ðŸŒ¿+ðŸŒ¿": "ðŸ€",         // herb + herb = clover
    "ðŸ€+ðŸ€": "ðŸŒ³",         // clover + clover = tree
    "ðŸŒ³+ðŸ”¥": "ðŸŒ²",         // tree + fire = pine tree (burnt?)
    "ðŸŒ±+ðŸ’§": "ðŸŒ»",         // seedling + water = sunflower
    "ðŸŒ»+ðŸŒ»": "ðŸŒ¼",         // sunflower + sunflower = flower
    "ðŸŒ¼+ðŸŒ¼": "ðŸ’",         // flower + flower = bouquet
    "ðŸ’+ðŸ’": "ðŸŽ‚",         // bouquet + bouquet = cake (celebration)
    "ðŸŽ+ðŸŽ": "ðŸ",         // apple + apple = green apple
    "ðŸ+ðŸŽ": "ðŸ¥§",         // green apple + apple = pie
    "ðŸ¥§+ðŸ”¥": "ðŸ°",         // pie + fire = cake
    "ðŸŒ²+ðŸŒ²": "ðŸžï¸",        // pine tree + pine tree = forest
    "ðŸžï¸+ðŸŒ³": "ðŸŒ„",        // forest + tree = mountain sunrise
    "ðŸŒŠ+ðŸŒŠ": "ðŸ›¶",         // ocean wave + ocean wave = canoe
    "ðŸ›¶+ðŸŒ²": "ðŸ•ï¸",        // canoe + tree = camping
    "ðŸ•ï¸+ðŸ”¥": "ðŸ”¥",         // camping + fire = fire (cycle)
    "ðŸ’§+ðŸŒ¿": "ðŸ„",         // water + herb = mushroom
    "ðŸ„+ðŸ„": "ðŸ¦‹",         // mushroom + mushroom = butterfly
    "ðŸ’¥+ðŸ”¥": "â˜„ï¸",         // explosion + fire = comet
    "â˜„ï¸+ðŸŒ²": "ðŸŒ‹",         // comet + tree = volcano
    "ðŸŒ‹+ðŸŒ§ï¸": "ðŸŒˆ",         // volcano + rain cloud = rainbow (ash in air)
  };

  const maxRecipes = 30;

  const startingEmojis = ["ðŸ”¥", "ðŸ’§", "ðŸŒ±", "ðŸŽ"];

  let inventory = [];
  let unlockedSet = new Set();
  let draggedEmoji = null;
  let draggedIndex = null;

  // For click crafting
  let clickSelectedIndex = null;

  const homeScreen = document.getElementById("homeScreen");
  const gameScreen = document.getElementById("gameScreen");
  const inventoryDiv = document.getElementById("inventory");
  const unlockedCounter = document.getElementById("unlockedCounter");
  const messageDiv = document.getElementById("message");
  const playBtn = document.getElementById("playBtn");
  const backButton = document.getElementById("backButton");

  // Save progress
  function saveProgress() {
    localStorage.setItem("emojiAlchemyInventory", JSON.stringify(inventory));
    localStorage.setItem("emojiAlchemyUnlocked", JSON.stringify(Array.from(unlockedSet)));
  }

  // Load progress
  function loadProgress() {
    const savedInventory = JSON.parse(localStorage.getItem("emojiAlchemyInventory"));
    const savedUnlocked = JSON.parse(localStorage.getItem("emojiAlchemyUnlocked"));

    if (Array.isArray(savedInventory) && savedInventory.length > 0) {
      inventory = savedInventory;
    } else {
      inventory = [...startingEmojis];
    }
    if (Array.isArray(savedUnlocked)) {
      unlockedSet = new Set(savedUnlocked);
    } else {
      unlockedSet = new Set(startingEmojis);
    }
  }

  function updateUnlockedCounter() {
    unlockedCounter.textContent = `Unlocked ${unlockedSet.size}/${maxRecipes}`;
  }

  function showMessage(text) {
    messageDiv.textContent = text;
    clearTimeout(messageDiv._timeout);
    messageDiv._timeout = setTimeout(() => {
      messageDiv.textContent = "";
    }, 3000);
  }

  // Render inventory with drag & click handlers
  function renderInventory() {
    inventoryDiv.innerHTML = "";
    inventory.forEach((emoji, i) => {
      const span = document.createElement("span");
      span.textContent = emoji;
      span.classList.add("emoji");
      span.setAttribute("draggable", "true");
      span.dataset.index = i;

      // Drag handlers
      span.addEventListener("dragstart", (e) => {
        draggedEmoji = emoji;
        draggedIndex = i;
        span.classList.add("dragging");
        e.dataTransfer.setData("text/plain", emoji);
        e.dataTransfer.effectAllowed = "move";
      });
      span.addEventListener("dragend", () => {
        draggedEmoji = null;
        draggedIndex = null;
        span.classList.remove("dragging");
      });
      span.addEventListener("dragover", (e) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = "move";
      });
      span.addEventListener("drop", (e) => {
        e.preventDefault();
        if (draggedEmoji === null) return;
        const targetIndex = i;
        if (targetIndex === draggedIndex) return;

        attemptCraft(draggedEmoji, inventory[targetIndex]);
      });

      // Click crafting: select two emojis in sequence
      span.addEventListener("click", () => {
        if (clickSelectedIndex === null) {
          clickSelectedIndex = i;
          span.classList.add("selected");
          showMessage(`Selected ${emoji}. Choose another to craft.`);
        } else if (clickSelectedIndex === i) {
          // Deselect if clicked same emoji twice
          clickSelectedIndex = null;
          span.classList.remove("selected");
          showMessage("Selection cleared.");
        } else {
          const first = inventory[clickSelectedIndex];
          const second = emoji;
          clickSelectedIndex = null;
          // Remove selection highlight
          document.querySelectorAll(".emoji.selected").forEach(el => el.classList.remove("selected"));
          attemptCraft(first, second);
        }
      });

      inventoryDiv.appendChild(span);
    });
  }

  function attemptCraft(emojiA, emojiB) {
    const pair = [emojiA, emojiB].sort().join("+");
    if (recipes.hasOwnProperty(pair)) {
      const result = recipes[pair];
      if (!unlockedSet.has(result)) {
        unlockedSet.add(result);
        inventory.push(result);
        showMessage(`Crafted new: ${result}`);
        updateUnlockedCounter();
        saveProgress();
        renderInventory();
      } else {
        showMessage(`Already unlocked: ${result}`);
      }
    } else {
      showMessage("No recipe for that combo.");
    }
  }

  playBtn.addEventListener("click", () => {
    homeScreen.style.display = "none";
    gameScreen.style.display = "flex";
    loadProgress();
    updateUnlockedCounter();
    renderInventory();
  });

  backButton.addEventListener("click", () => {
    gameScreen.style.display = "none";
    homeScreen.style.display = "flex";
    clickSelectedIndex = null;
  });
})();
</script>

</body>
</html>
